var e=(e,t,s)=>new Promise(((n,i)=>{var o=e=>{try{a(s.next(e))}catch(t){i(t)}},r=e=>{try{a(s.throw(e))}catch(t){i(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,r);a((s=s.apply(e,t)).next())}));!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t{constructor(){this.groups=[{id:"1212236082236816",name:"Bộ Tộc",icon:"fas fa-users",color:"btn-primary"},{id:"123456789012345",name:"Cộng Đồng",icon:"fas fa-home",color:"btn-secondary"},{id:"234567890123456",name:"Hội Nhóm",icon:"fas fa-handshake",color:"btn-accent"},{id:"345678901234567",name:"Gia Đình",icon:"fas fa-heart",color:"btn-info"}],this.selectedGroup={id:"1212236082236816",name:"Bộ Tộc"},this.initializeElements(),this.bindEvents(),this.initializeGroupPresets()}initializeElements(){this.urlInput=document.getElementById("url-input"),this.downloadBtn=document.getElementById("download-btn"),this.resultContainer=document.getElementById("result-container"),this.loading=document.getElementById("loading"),this.downloadResult=document.getElementById("download-result"),this.errorContainer=document.getElementById("error-container"),this.errorMessage=document.getElementById("error-message"),this.clearInput=document.getElementById("clear-input"),this.groupPresetBtns=document.querySelectorAll(".group-preset-btn")}bindEvents(){this.downloadBtn.addEventListener("click",(()=>this.handleSubmit())),this.clearInput.addEventListener("click",(()=>this.clearInputField())),this.urlInput.addEventListener("input",(()=>this.toggleClearButton())),this.urlInput.addEventListener("keydown",(e=>{"Enter"===e.key&&e.ctrlKey&&this.handleSubmit()})),this.groupPresetBtns.forEach((e=>{e.addEventListener("click",(t=>{const s=e.getAttribute("data-group-id"),n=e.getAttribute("data-group-name");this.handleGroupPreset(s,n)}))}))}toggleClearButton(){const e=this.urlInput.value.trim().length>0;this.clearInput.style.opacity=e?"1":"0"}clearInputField(){this.urlInput.value="",this.toggleClearButton(),this.hideResult()}showLoading(){this.loading.classList.remove("hidden"),this.downloadResult.classList.add("hidden"),this.errorContainer.classList.add("hidden"),this.resultContainer.classList.remove("hidden")}hideLoading(){this.loading.classList.add("hidden")}showResult(e){this.downloadResult.innerHTML=e,this.downloadResult.classList.remove("hidden"),this.resultContainer.classList.remove("hidden")}showError(e){this.errorMessage.textContent=e,this.errorContainer.classList.remove("hidden"),this.resultContainer.classList.remove("hidden")}hideResult(){this.resultContainer.classList.add("hidden"),this.loading.classList.add("hidden"),this.downloadResult.classList.add("hidden"),this.errorContainer.classList.add("hidden")}fetchUID(t){return e(this,null,(function*(){try{const e=yield fetch("/api/fetch-uid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({identifier:t})});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return yield e.json()}catch(e){throw new Error(`Lỗi khi tìm UID: ${e.message}`)}}))}buildUrl(e){return e.startsWith("http")?e:`https://www.facebook.com/${e}/`}handleSubmit(){return e(this,null,(function*(){const e=this.urlInput.value.trim();if(!e)return void this.showError("Vui lòng nhập Facebook URL hoặc username");const t=e.split("\n").filter((e=>e.trim()));if(0!==t.length){this.showLoading();try{const e=[];for(const n of t){const t=n.trim();if(t)try{const s=yield this.fetchUID(t);e.push({identifier:t,uid:s.uid,url:this.buildUrl(t),success:!0})}catch(s){e.push({identifier:t,error:s.message,url:this.buildUrl(t),success:!1})}}this.displayResults(e)}catch(s){this.showError(s.message)}finally{this.hideLoading()}}else this.showError("Vui lòng nhập ít nhất một Facebook URL hoặc username")}))}displayResults(e){let t='<div class="space-y-4">';e.forEach(((e,s)=>{if(e.success){let s="";if(this.selectedGroup){const t=this.groups.find((e=>e.id===this.selectedGroup.id));t&&(s=`\n                            <button class="btn btn-sm ${t.color} group-btn" \n                                    data-uid="${e.uid}" \n                                    data-group-id="${t.id}"\n                                    data-group-name="${t.name}">\n                                <i class="${t.icon}"></i>\n                                Vào ${t.name}\n                            </button>\n                        `)}else s=this.groups.map((t=>`\n                        <button class="btn btn-sm ${t.color} group-btn" \n                                data-uid="${e.uid}" \n                                data-group-id="${t.id}"\n                                data-group-name="${t.name}">\n                            <i class="${t.icon}"></i>\n                            ${t.name}\n                        </button>\n                    `)).join("");t+=`\n                    <div class="alert alert-success bg-green-100 border-green-400 text-green-700 rounded-xl">\n                        <div class="flex flex-col w-full space-y-3">\n                            <div class="flex items-center justify-between">\n                                <div class="flex flex-col">\n                                    <p class="font-semibold">${e.identifier}</p>\n                                    <p class="text-sm opacity-75">UID: ${e.uid}</p>\n                                </div>\n                                <div class="flex space-x-2">\n                                    <button class="btn btn-sm btn-outline copy-uid-btn" \n                                            data-uid="${e.uid}">\n                                        <i class="fas fa-copy"></i>\n                                        Copy UID\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="flex flex-wrap gap-2">\n                                ${s}\n                            </div>\n                        </div>\n                    </div>\n                `}else t+=`\n                    <div class="alert alert-error bg-red-100 border-red-400 text-red-700 rounded-xl">\n                        <div class="flex items-center space-x-3">\n                            <i class="fas fa-exclamation-circle text-red-600"></i>\n                            <div>\n                                <div class="font-semibold">${e.identifier}</div>\n                                <div class="text-sm opacity-75">${e.error}</div>\n                            </div>\n                        </div>\n                    </div>\n                `})),t+="</div>",this.showResult(t),document.querySelectorAll(".group-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault();const s=e.getAttribute("data-uid"),n=e.getAttribute("data-group-id"),i=e.getAttribute("data-group-name");this.openGroupLink(s,n,i)}))})),document.querySelectorAll(".copy-uid-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault();const s=e.getAttribute("data-uid");this.copyUID(s)}))}))}copyGroupLink(e,t,s){const n=`https://www.facebook.com/groups/${t}/user/${e}`;navigator.clipboard.writeText(n).then((()=>{const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg z-50 shadow-lg",e.innerHTML=`\n                <div class="flex items-center space-x-2">\n                    <i class="fas fa-check-circle"></i>\n                    <span>Đã copy link ${s}!</span>\n                </div>\n            `,document.body.appendChild(e),setTimeout((()=>{document.body.removeChild(e)}),3e3)})).catch((e=>{const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg z-50 shadow-lg",t.innerHTML='\n                <div class="flex items-center space-x-2">\n                    <i class="fas fa-exclamation-circle"></i>\n                    <span>Lỗi khi copy link!</span>\n                </div>\n            ',document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),3e3)}))}openGroupLink(e,t,s){const n=`https://www.facebook.com/groups/${t}/user/${e}`;window.open(n,"_blank"),this.showToast(`Đã mở link ${s}!`,"success")}copyUID(e){navigator.clipboard.writeText(e).then((()=>{this.showToast("Đã copy UID!","success")})).catch((e=>{this.showToast("Lỗi khi copy UID!","error")}))}initializeGroupPresets(){document.querySelectorAll(".group-preset-btn").forEach((e=>{e.addEventListener("click",(e=>{this.handleGroupPreset(e.target.closest(".group-preset-btn"))}))}))}handleGroupPreset(e){const t=e.getAttribute("data-group-id"),s=e.getAttribute("data-group-name");this.selectedGroup={id:t,name:s},this.updateGroupPresetVisualState(e)}updateGroupPresetVisualState(e){document.querySelectorAll(".group-preset-btn").forEach((t=>{if(t===e){t.classList.add("active","ring-2","shadow-lg","transform","scale-105"),t.classList.remove("opacity-70"),t.style.opacity="1";const e=window.getComputedStyle(t).backgroundColor;e.includes("29, 119, 242")?t.classList.add("ring-[#1877F2]","ring-offset-2"):e.includes("66, 184, 131")?t.classList.add("ring-[#42B883]","ring-offset-2"):e.includes("230, 126, 34")?t.classList.add("ring-[#E67E22]","ring-offset-2"):e.includes("233, 30, 99")&&t.classList.add("ring-[#E91E63]","ring-offset-2")}else t.classList.remove("active","ring-2","shadow-lg","transform","scale-105"),t.classList.remove("ring-[#1877F2]","ring-[#42B883]","ring-[#E67E22]","ring-[#E91E63]","ring-offset-2"),t.classList.add("opacity-70"),t.classList.add("hover:opacity-100","transition-all","duration-200")}))}showToast(e,t="success"){const s=document.createElement("div"),n="success"===t?"bg-green-500":"bg-red-500",i="success"===t?"fas fa-check-circle":"fas fa-exclamation-circle";s.className=`fixed top-4 right-4 ${n} text-white px-4 py-2 rounded-lg z-50 shadow-lg`,s.innerHTML=`\n            <div class="flex items-center space-x-2">\n                <i class="${i}"></i>\n                <span>${e}</span>\n            </div>\n        `,document.body.appendChild(s),setTimeout((()=>{document.body.contains(s)&&document.body.removeChild(s)}),3e3)}}document.addEventListener("DOMContentLoaded",(()=>{new t}));
